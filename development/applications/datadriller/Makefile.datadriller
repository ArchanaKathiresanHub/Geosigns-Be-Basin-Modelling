ROOTDIR	= ..
LIBDIR = ../../../libraries

FILE_BASE = ../../../files
include $(FILE_BASE)/Make.targets
include $(FILE_BASE)/Make.3rdparty
include $(FILE_BASE)/Make.libraries
include $(FILE_BASE)/Make.machine

#
MKL_ROOT = /nfs/rvl/apps/3rdparty/intel/ics2011/composerxe-2011.3.174/mkl
MKL_LIB = \
   -Wl,--start-group \
   $(MKL_ROOT)/lib/intel64/libmkl_intel_lp64.a \
   $(MKL_ROOT)/lib/intel64/libmkl_sequential.a \
   $(MKL_ROOT)/lib/intel64/libmkl_core.a \
   -Wl,--end-group \
   -lpthread

CC = $(CXX)
CLINKER = $(CC)

FLEXLMBITS      = 64
FLEX_LIB        = $(FLEXLMINCLUDEDIR)/$(APPSOS)/lib$(FLEXLMBITS)/EPTFlexLm.o
FLEX_INCLUDE    = $(FLEXLMINCLUDEDIR)/include



MAKEDEPEND = /usr/bin/makedepend

DOXYGEN = doxygen
DOXYGENCFG = fastcauldron.cfg

SRCDIR  	= $(ROOTDIR)/src/

SERIAL_DATA_ACCESS_INC = $(LIBDIR)/SerialDataAccess/src
SERIAL_DATA_ACCESS_LIB = $(LIBDIR)/lib/$(machine)/libSerialDataAccess.a

DATA_ACCESS_INC = $(LIBDIR)/DataAccess/src
DATA_ACCESS_LIB = $(LIBDIR)/lib/$(machine)/libDataAccess.a

EOSPACK_INC = $(LIBDIR)/EosPack/src
EOSPACK_LIB	= $(LIBDIR)/lib/$(machine)/libEosPack.a

UTILITIES_INC	= $(LIBDIR)/utilities/src
UTILITIES_LIB    = $(LIBDIR)/lib/$(machine)/libutilities.a

LINEARALGEBRA_INC	= $(LIBDIR)/LinearAlgebra/src
LINEARALGEBRA_LIB	= $(LIBDIR)/lib/$(machine)/libLinearAlgebra.a

INTERPOLATION_INC	= $(LIBDIR)/Interpolation/src
INTERPOLATION_LIB	= $(LIBDIR)/lib/$(machine)/libInterpolation.a

DATAMINING_INC	= $(LIBDIR)/DataMining/src
DATAMINING_LIB	= $(LIBDIR)/lib/$(machine)/libDataMining.a

CBMGENERICS_INC	= $(LIBDIR)/CBMGenerics/src
CBMGENERICS_LIB	= $(LIBDIR)/lib/$(machine)/libCBMGenerics.a

CALIBRATIONKERNEL_INC	= $(LIBDIR)/calibration_kernel/src
CALIBRATIONKERNEL_LIB	= $(LIBDIR)/lib/$(machine)/libcalibration_kernel.a

CRUSTALTHICKNESS_INC	= $(LIBDIR)/CrustalThickness/src
CRUSTALTHICKNESS_LIB	= $(LIBDIR)/lib/$(machine)/libCrustalThickness.a

HEADERS=

SOURCES=datadriller.C

EXEOBJECTS=$(SOURCES:.C=.o)

EXELIBS=\
	$(DATAMINING_LIB)\
	$(DATA_ACCESS_LIB) \
	$(SERIAL_DATA_ACCESS_LIB) \
	$(DATA_ACCESS_LIB) \
	$(TABLEIO_LIB)\
	$(CBMGENERICS_LIB)\
	$(GEOPHYSICS_LIB)\
	$(GENEX6KERNEL_LIB)\
	$(GENEX6_LIB)\
	$(CRUSTALTHICKNESS_LIB) \
	$(BLASLIBPATH)\
	$(OTGC6_LIB)\
 	$(CBMGENERICS_LIB)\
	$(H5_SERIAL_LIB)\
	$(EOSPACK_LIB)\
	$(UTILITIES_LIB)\
	$(DATABASE_LIB)\
	$(UTILITIES_LIB)\
	$(LINEARALGEBRA_LIB)\
	$(INTERPOLATION_LIB)\
	$(FINITE_ELEMENTS_LIB)\
	$(HDF5_SLIB)/libhdf5.a\
	$(MKL_LIB)\
	 -lz -lrt

CFLAGS= ${PROFILEFLAGS}  ${COMPILEFLAGS} ${DEBUGFLAGS} \
	-I/usr/include\
	-I$(DATAMINING_INC) \
	-I$(SERIAL_DATA_ACCESS_INC)\
	-I$(SERIAL_DATA_ACCESS_INC)/Interface\
	-I$(DATA_ACCESS_INC)\
	-I$(DATA_ACCESS_INC)/Interface\
	-I$(HDF5_SINCLUDE)\
	-I$(EOSPACK_INC) \
	-I$(UTILITIES_INC) \
	-I$(H5_SERIAL_INC)\
	-I$(GEMPIS_INC) \
	-I$(DATABASE_INC)\
	-I$(BLASINCPATH)\
	-I$(THREADUTILITIES_INC) \
	-I$(LINEARALGEBRA_INC) \
	-I$(INTERPOLATION_INC) \
	-I$(FINITE_ELEMENTS_INC) \
 -I$(CBMGENERICS_INC) \
	-I$(GEOPHYSICS_INC) \
	-I$(CALIBRATIONKERNEL_INC)

#CXXFLAGS += $(INCLUDEDIRS) -DUSEINTERFACE

vpath %.h $(SRCDIR)
vpath %.C $(SRCDIR)

OBJDIR		= .
vpath %.o $(OBJDIR)

EXE = datadriller

target: datadriller

datadriller : $(EXEOBJECTS) 
	$(PRELINK) $(CLINKER) $(LDFLAGS) -o $(EXE) $(EXEOBJECTS) $(EXELIBS)

clean :
	rm -rf $(EXEOBJECTS) $(EXE) *~

doc:
	cd ../src && $(DOXYGEN) $(DOXYGENCFG)

depend: $(EXEOBJECTS:.o=.C)
	cd ../src && $(MAKEDEPEND) -f../Makefile.datadriller -Y $(INCLUDEDIRS) $(HEADERS) $(SOURCES) 2> /dev/null
# DO NOT DELETE

datadriller.o: errorhandling.h
