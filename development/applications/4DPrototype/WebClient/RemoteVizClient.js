function RemoteVizRenderArea(l,r,s){this.version=1;this.id=l;this.img=new Image;this.source;this.canvas=document.getElementById(this.id);this.ctx;this.serverHeight=this.serverWidth=0;this.canvas.width=r;this.canvas.height=s;var k=!1;document.getElementById(l).ondragstart=function(){return!1};this.events={};this.addServiceListener=function(a){this.events.hasOwnProperty("ServiceEvent")?this.events.ServiceEvent.push(a):this.events.ServiceEvent=[a]};this.removeServiceListener=function(a){this.events.hasOwnProperty("ServiceEvent")&&
(a=this.events.ServiceEvent.indexOf(a),-1!=a&&this.events.ServiceEvent.splice(a,1))};this.addReceivedImageListener=function(a){this.events.hasOwnProperty("ReceivedImageEvent")?this.events.ReceivedImageEvent.push(a):this.events.ReceivedImageEvent=[a]};this.removeReceivedImageListener=function(a){this.events.hasOwnProperty("ReceivedImageEvent")&&(a=this.events.ReceivedImageEvent.indexOf(a),-1!=a&&this.events.ReceivedImageEvent.splice(a,1))};this.addResizeListener=function(a){this.events.hasOwnProperty("ResizeEvent")?
this.events.ResizeEvent.push(a):this.events.ResizeEvent=[a]};this.removeResizeListener=function(a){this.events.hasOwnProperty("ResizeEvent")&&(a=this.events.ResizeEvent.indexOf(a),-1!=a&&this.events.ResizeEvent.splice(a,1))};this.addMessageListener=function(a){this.events.hasOwnProperty("CommandEvent")?this.events.CommandEvent.push(a):this.events.CommandEvent=[a]};this.removeMessageListener=function(a){this.events.hasOwnProperty("CommandEvent")&&(a=this.events.CommandEvent.indexOf(a),-1!=a&&this.events.CommandEvent.splice(a,
1))};this.addMouseMoveListener=function(a){this.events.hasOwnProperty("MouseMoveEvent")?this.events.MouseMoveEvent.push(a):this.events.MouseMoveEvent=[a]};this.removeMouseMoveListener=function(a){this.events.hasOwnProperty("MouseMoveEvent")&&(a=this.events.MouseMoveEvent.indexOf(a),-1!=a&&this.events.MouseMoveEvent.splice(a,1))};this.addMouseDownListener=function(a){this.events.hasOwnProperty("MouseDownEvent")?this.events.MouseDownEvent.push(a):this.events.MouseDownEvent=[a]};this.removeMouseDownListener=
function(a){this.events.hasOwnProperty("MouseDownEvent")&&(a=this.events.MouseDownEvent.indexOf(a),-1!=a&&this.events.MouseDownEvent.splice(a,1))};this.addMouseUpListener=function(a){this.events.hasOwnProperty("MouseUpEvent")?this.events.MouseUpEvent.push(a):this.events.MouseUpEvent=[a]};this.removeMouseUpListener=function(a){this.events.hasOwnProperty("MouseUpEvent")&&(a=this.events.MouseUpEvent.indexOf(a),-1!=a&&this.events.MouseUpEvent.splice(a,1))};this.addMouseOverListener=function(a){this.events.hasOwnProperty("MouseOverEvent")?
this.events.MouseOverEvent.push(a):this.events.MouseOverEvent=[a]};this.removeMouseOverListener=function(a){this.events.hasOwnProperty("MouseOverEvent")&&(a=this.events.MouseOverEvent.indexOf(a),-1!=a&&this.events.MouseOverEvent.splice(a,1))};this.addMouseOutListener=function(a){this.events.hasOwnProperty("MouseOutEvent")?this.events.MouseOutEvent.push(a):this.events.MouseOutEvent=[a]};this.removeMouseOutListener=function(a){this.events.hasOwnProperty("MouseOutEvent")&&(a=this.events.MouseOutEvent.indexOf(a),
-1!=a&&this.events.MouseOutEvent.splice(a,1))};this.addMouseWheelListener=function(a){this.events.hasOwnProperty("MouseWheelEvent")?this.events.MouseWheelEvent.push(a):this.events.MouseWheelEvent=[a]};this.removeMouseWheelListener=function(a){this.events.hasOwnProperty("MouseWheelEvent")&&(a=this.events.MouseWheelEvent.indexOf(a),-1!=a&&this.events.MouseWheelEvent.splice(a,1))};this.addTouchStartListener=function(a){this.events.hasOwnProperty("TouchStartEvent")?this.events.TouchStartEvent.push(a):
this.events.TouchStartEvent=[a]};this.removeTouchStartListener=function(a){this.events.hasOwnProperty("TouchStartEvent")&&(a=this.events.TouchStartEvent.indexOf(a),-1!=a&&this.events.TouchStartEvent.splice(a,1))};this.addTouchEndListener=function(a){this.events.hasOwnProperty("TouchEndEvent")?this.events.TouchEndEvent.push(a):this.events.TouchEndEvent=[a]};this.removeTouchEndListener=function(a){this.events.hasOwnProperty("TouchEndEvent")&&(a=this.events.TouchEndEvent.indexOf(a),-1!=a&&this.events.TouchEndEvent.splice(a,
1))};this.addTouchCancelListener=function(a){this.events.hasOwnProperty("TouchCancelEvent")?this.events.TouchCancelEvent.push(a):this.events.TouchCancelEvent=[a]};this.removeTouchCancelListener=function(a){this.events.hasOwnProperty("TouchCancelEvent")&&(a=this.events.TouchCancelEvent.indexOf(a),-1!=a&&this.events.TouchCancelEvent.splice(a,1))};this.addTouchMoveListener=function(a){this.events.hasOwnProperty("TouchMoveEvent")?this.events.TouchMoveEvent.push(a):this.events.TouchMoveEvent=[a]};this.removeTouchMoveListener=
function(a){this.events.hasOwnProperty("TouchMoveEvent")&&(a=this.events.TouchMoveEvent.indexOf(a),-1!=a&&this.events.TouchMoveEvent.splice(a,1))};this.addKeyUpListener=function(a){this.events.hasOwnProperty("KeyUpEvent")?this.events.KeyUpEvent.push(a):this.events.KeyUpEvent=[a]};this.removeKeyUpListener=function(a){this.events.hasOwnProperty("KeyUpEvent")&&(a=this.events.KeyUpEvent.indexOf(a),-1!=a&&this.events.KeyUpEvent.splice(a,1))};this.addKeyDownListener=function(a){this.events.hasOwnProperty("KeyDownEvent")?
this.events.KeyDownEvent.push(a):this.events.KeyDownEvent=[a]};this.removeKeyDownListener=function(a){this.events.hasOwnProperty("KeyDownEvent")&&(a=this.events.KeyDownEvent.indexOf(a),-1!=a&&this.events.KeyDownEvent.splice(a,1))};var c=function(a,b,d){if(!a.events.hasOwnProperty(d))return!0;a=a.events[d];d=a.length;for(var c=!1,e=0;e<d;e++)c|=a[e](b);return c},w=function(a,b){if(a.events.hasOwnProperty("ReceivedImageEvent")){if(!b||!b.length)b=[];for(var d=a.events.ReceivedImageEvent,c=d.length,
e=0;e<c;e++)d[e].apply(null,b)}},t=function(a,b){if(a.events.hasOwnProperty("ServiceEvent")){if(!b||!b.length)b=[];for(var d=a.events.ServiceEvent,c=d.length,e=0;e<c;e++)d[e].apply(null,b)}};!window.WebSocket&&window.MozWebSocket?window.WebSocket=window.MozWebSocket:!window.WebSocket&&!window.MozWebSocket&&alert("Your browser does not support WebSocket.");var e=function(a,b){return function(){return b.apply(a,arguments)}};this.sendMessage=function(a){if(k&&null!=this.websocket){var b={type:"command"};
b.message=a;this.websocket.send(JSON.stringify(b))}};this.requestRenderAreaSize=function(a,b){if(k&&null!=this.websocket){var d={type:"requestsize"};d.width=a;d.height=b;this.websocket.send(JSON.stringify(d))}};this.getRenderAreaWidth=function(){return this.serverWidth};this.getRenderAreaHeight=function(){return this.serverHeight};this.resizeRenderAreaContainer=function(a,b){this.canvas.width=a;this.canvas.height=b;this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);this.redraw()};
var m=function(a,b){return b*a.serverWidth/a.canvas.width},n=function(a,b){return b*a.serverHeight/a.canvas.height},p=function(a,b,d){var c=0,e=0;null!=a.canvas.offsetParent?(c=m(a,d.clientX-(a.canvas.offsetParent.offsetLeft+a.canvas.offsetLeft)),e=n(a,a.canvas.height-d.clientY+a.canvas.offsetParent.offsetTop+a.canvas.offsetTop)):(c=m(a,d.clientX-a.canvas.offsetLeft),e=n(a,a.canvas.height-d.clientY+a.canvas.offsetTop));if(k&&null!=a.websocket){var g={type:"mouseevent"};g.event=b;g.x=c;g.y=e;g.button=
d.button;a.websocket.send(JSON.stringify(g))}},v=function(a,b,d){if(k&&null!=a.websocket){var c={type:"keyevent"};c.event=b;c.key=d.keyCode;a.websocket.send(JSON.stringify(c))}},q=function(a,b,d){for(var c=d.changedTouches,e=0;e<c.length;e++){var g=c[e],x=g.identifier,h=0,f=0;null!=a.canvas.offsetParent?(h=m(a,g.clientX-(a.canvas.offsetParent.offsetLeft+a.canvas.offsetLeft)),f=n(a,a.canvas.height-g.clientY+a.canvas.offsetParent.offsetTop+a.canvas.offsetTop)):(h=m(a,g.clientX-a.canvas.offsetLeft),
f=n(a,a.canvas.height-g.clientY+a.canvas.offsetTop));k&&null!=a.websocket&&(g={type:"touchevent"},g.event=b,g.id=x,g.x=h,g.y=f,a.websocket.send(JSON.stringify(g)))}d.preventDefault()},f=function(a,b,d){"down"==b&&a.canvas.focus();var c=d.pointerId,e=0,g=0;null!=a.canvas.offsetParent?(e=m(a,d.clientX-(a.canvas.offsetParent.offsetLeft+a.canvas.offsetLeft)),g=n(a,a.canvas.height-d.clientY+a.canvas.offsetParent.offsetTop+a.canvas.offsetTop)):(e=m(a,d.clientX-a.canvas.offsetLeft),g=n(a,a.canvas.height-
d.clientY+a.canvas.offsetTop));if(k&&null!=a.websocket)var f=b;if(d.pointerType==d.MSPOINTER_TYPE_MOUSE||"mouse"==d.pointerType){var h={type:"mouseevent"};h.event="mouse"+b;h.x=e;h.y=g;h.button=0!=d.which?d.which-1:-1;a.websocket.send(JSON.stringify(h))}else if(d.pointerType==d.MSPOINTER_TYPE_TOUCH||"touch"==d.pointerType){if("down"==b||"enter"==b)f="start";else if("up"==b||"cancel"==b||"leave"==b)f="end";h={type:"touchevent"};h.event="touch"+f;h.x=e;h.y=g;h.id=c;a.websocket.send(JSON.stringify(h))}d.preventDefault()},
u=function(a,b){var d={type:"mouseevent",event:"mousewheel"};d.delta=b.wheelDelta/120;a.websocket.send(JSON.stringify(d))};l=function(a){var b={type:"mouseevent",event:"mousewheel"};b.delta=-a.detail/3;this.websocket.send(JSON.stringify(b))};"undefined"!=typeof this.canvas.style.msTouchAction&&(this.canvas.style.msTouchAction="none");"undefined"!=typeof this.canvas.style.TouchAction&&(this.canvas.style.TouchAction="none");this.ctx=this.canvas.getContext("2d");this.redraw=function(){this.ctx.drawImage(this.img,
0,0,this.ctx.canvas.width,this.ctx.canvas.height)};this.img.onload=e(this,this.redraw);var y=function(){var a=navigator.userAgent.toLowerCase();return-1!=a.indexOf("msie")?parseInt(a.split("msie")[1]):!1};window.navigator.msPointerEnabled||window.navigator.pointerEnabled?10==y()?(this.canvas.onmspointerdown=e(this,function(a){(a.pointerType==a.MSPOINTER_TYPE_MOUSE&&c(this,a,"MouseDownEvent")||a.pointerType==a.MSPOINTER_TYPE_TOUCH&&c(this,a,"TouchStartEvent"))&&f(this,"down",a)}),this.canvas.onmspointermove=
e(this,function(a){(a.pointerType==a.MSPOINTER_TYPE_MOUSE&&c(this,a,"MouseMoveEvent")||a.pointerType==a.MSPOINTER_TYPE_TOUCH&&c(this,a,"TouchMoveEvent"))&&f(this,"move",a)}),this.canvas.onmspointerup=e(this,function(a){(a.pointerType==a.MSPOINTER_TYPE_MOUSE&&c(this,a,"MouseUpEvent")||a.pointerType==a.MSPOINTER_TYPE_TOUCH&&c(this,a,"TouchEndEvent"))&&f(this,"up",a)}),this.canvas.onmspointercancel=e(this,function(a){a.pointerType==a.MSPOINTER_TYPE_TOUCH&&c(this,a,"TouchCancelEvent")&&f(this,"cancel",
a)}),this.canvas.onmspointerout=e(this,function(a){(a.pointerType==a.MSPOINTER_TYPE_MOUSE&&c(this,a,"MouseOutEvent")||a.pointerType==a.MSPOINTER_TYPE_TOUCH&&c(this,a,"TouchEndEvent"))&&f(this,"leave",a)}),this.canvas.onmspointerover=e(this,function(a){(a.pointerType==a.MSPOINTER_TYPE_MOUSE&&c(this,a,"MouseOverEvent")||a.pointerType==a.MSPOINTER_TYPE_TOUCH&&c(this,a,"TouchStartEvent"))&&f(this,"enter",a)}),this.canvas.onmousewheel=e(this,function(a){c(this,a,"MouseWheelEvent")&&u(this,a)})):(this.canvas.onpointerdown=
e(this,function(a){("mouse"==a.pointerType&&c(this,a,"MouseDownEvent")||"touch"==a.pointerType&&c(this,a,"TouchStartEvent"))&&f(this,"down",a)}),this.canvas.onpointermove=e(this,function(a){("mouse"==a.pointerType&&c(this,a,"MouseMoveEvent")||"touch"==a.pointerType&&c(this,a,"TouchMoveEvent"))&&f(this,"move",a)}),this.canvas.onpointerup=e(this,function(a){("mouse"==a.pointerType&&c(this,a,"MouseUpEvent")||"touch"==a.pointerType&&c(this,a,"TouchEndEvent"))&&f(this,"up",a)}),this.canvas.onpointercancel=
e(this,function(a){"touch"==a.pointerType&&c(this,a,"TouchCancelEvent")&&f(this,"cancel",a)}),this.canvas.onpointerout=e(this,function(a){("mouse"==a.pointerType&&c(this,a,"MouseOutEvent")||"touch"==a.pointerType&&c(this,a,"TouchEndEvent"))&&f(this,"leave",a)}),this.canvas.onpointerover=e(this,function(a){("mouse"==a.pointerType&&c(this,a,"MouseOverEvent")||"touch"==a.pointerType&&c(this,a,"TouchStartEvent"))&&f(this,"enter",a)}),this.canvas.onmousewheel=e(this,function(a){c(this,a,"MouseWheelEvent")&&
u(this,a)})):(this.canvas.ontouchstart=e(this,function(a){c(this,a,"TouchStartEvent")&&q(this,"touchstart",a)}),this.canvas.ontouchmove=e(this,function(a){c(this,a,"TouchMoveEvent")&&q(this,"touchmove",a)}),this.canvas.ontouchend=e(this,function(a){c(this,a,"TouchEndEvent")&&q(this,"touchend",a)}),this.canvas.ontouchcancel=e(this,function(a){c(this,a,"TouchCancelEvent")&&q(this,"touchend",a)}),this.canvas.onmousedown=e(this,function(a){c(this,a,"MouseDownEvent")&&p(this,"mousedown",a)}),this.canvas.onmouseover=
e(this,function(a){c(this,a,"MouseOverEvent")&&p(this,"mouseenter",a)}),this.canvas.onmouseout=e(this,function(a){c(this,a,"MouseOutEvent")&&p(this,"mouseleave",a)}),this.canvas.onmouseup=e(this,function(a){c(this,a,"MouseUpEvent")&&p(this,"mouseup",a)}),this.canvas.onmousemove=e(this,function(a){c(this,a,"MouseMoveEvent")&&p(this,"mousemove",a)}),this.canvas.onmousewheel=e(this,function(a){c(this,a,"MouseWheelEvent")&&u(this,a)}),l=l.bind(this),this.canvas.addEventListener("DOMMouseScroll",l,!1));
this.canvas.onkeyup=e(this,function(a){c(this,a,"KeyUpEvent")&&v(this,"keyup",a)});this.canvas.onkeydown=e(this,function(a){c(this,a,"KeyDownEvent")&&v(this,"keydown",a)});this.canvas.setAttribute("tabindex","0");this.canvas.focus();var z=function(a){k&&null!=a.websocket&&a.websocket.send(JSON.stringify({type:"alive"}))};this.wsonopen=function(){var a;a=this.svcUrl;var b=a.match("^((ws|wss)://)([^/]*)")||[];a=0<b.length?-1==a.indexOf("requestedHeight")&&-1==a.indexOf("requestedWidth")?-1==a.indexOf("?")?
a.slice(b[0].length+1,a.length)+"?requestedWidth="+r+"&requestedHeight="+s:a.slice(b[0].length+1,a.length)+"&requestedWidth="+r+"&requestedHeight="+s:a.slice(b[0].length+1,a.length):null;null!=a?(b={type:"connection"},b.protocolversion=this.version,b.url=a,this.websocket.send(JSON.stringify(b))):alert("Bad URL format.")};this.wsonclose=function(a){if(k){k=!1;var b=this;setTimeout(function(){t(b,[["disconnected","NETWORKFAILURE"]])},1)}};this.wsonmessage=function(a){if(null!=this.websocket){var b=
this,d=JSON.parse(a.data);"accept"==d.type?(this.serverWidth=d.width,this.serverHeight=d.height,k=!0,setInterval(z,5E3,b),setTimeout(function(){t(b,[["connected",d.width,d.height]])},1)):k&&"command"==d.type?setTimeout(function(){var a=[d.message];if(b.events.hasOwnProperty("CommandEvent")){if(!a||!a.length)a=[];for(var c=b.events.CommandEvent,e=c.length,f=0;f<e;f++)c[f].apply(null,a)}},1):k&&"resize"==d.type?(this.serverWidth=d.width,this.serverHeight=d.height,setTimeout(function(){var a=[[d.width,
d.height]];if(b.events.hasOwnProperty("ResizeEvent")){if(!a||!a.length)a=[];for(var c=b.events.ResizeEvent,e=c.length,f=0;f<e;f++)c[f].apply(null,a)}},1)):"disconnect"==d.type?setTimeout(function(){t(b,[["disconnected",d.reason]])},1):k&&"image"==d.type&&(this.img.src="data:"+d.contenttype+";base64,"+d.data,w(b,[d.data.length]),this.websocket.send(JSON.stringify({type:"ack"})))}};this.connectTo=function(a){this.svcUrl=a;this.websocket=new WebSocket(a);this.websocket.onopen=e(this,this.wsonopen);this.websocket.onclose=
e(this,this.wsonclose);this.websocket.onmessage=e(this,this.wsonmessage)};this.disconnect=function(){null!=this.websocket&&(this.websocket.close(),this.websocket=null,k=!1)};this.isConnected=function(){return null!=this.websocket?1==this.websocket.readyState:!1}};
