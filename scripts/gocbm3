# gocbm - script for defining the development environment for Cauldron CBM
#
# To use: Call once from your development directory 
#
# Syntax:	source /nfs/rvl/users/ibs/bin/gocbm [32|64]
# 
# 	[32|64] - optional override for number of bits of target platform
#
# Variables created or modified:
#  PATH			- Compensated so correct development tools are selected
#  MAKE			- Changed where necessary
#  CC	                - for Sun platform
#  CXX                  - for Sun platform
#  IBS_HOME		- Base location of IBS 
#  IBS_BIN		- The location of the IBS binary directory
#  IBS_3RDPARTY		- The location of the IBS 3rd party tools
#  CSCE_ARCH		- Hardware platform as defined by the getos2 command
#  LOCAL		- Local env. var as required by socom
#  machine		- Hardware platform as required by socom
#  USE64BITS		- Set TRUE when machine is 64-bits
#  PETSC_ARCH		- Hardware platform as expected by PETSc libraries
#  MPI_BIN		- Default MPI bin directory (set to OPTIMIZED)
#  MPI_OBIN		- Optimized MPI executables
#  MPI_DBIN		- Debug MPI executables
#  P4_RSHCOMMAND	- definitions required for MPICH connection
# Notes:
#  PETSc defined as 64-bit because we don't have or use a 32-bit PETSc
#
###############################################################################

echo "Setting up Cauldron CBM Development Environment"
echo "Turning off any previious definition of machine."
unset machine

###############################################################################
#
# general setup
#
setenv IBS_HOME /nfs/rvl/users/ibs
setenv IBS_BIN ${IBS_HOME}/bin
setenv IBS_3RDPARTY ${IBS_HOME}/IBS/EXTERNALS
setenv IBS_FIELDWIDTH 24

# define the name of the maintainer of this environment
setenv CBM_MAINTAINER Gregory.Lackore@shell.com

# define root directory of CBM development
setenv CBM_HOME /nfs/rvl/groups/ept-sg/SWEast/Cauldron

# remove flags used by other scripts
unsetenv MAKEFLAGS

# define the alpha release base directory
setenv ALPHA_BASE ${CBM_HOME}/alpha

# define home location of the source code repository
setenv REPOSITORY_HOME ${CBM_HOME}/Repository

# define home location of Nightly build
setenv NIGHTLY_HOME       ${CBM_HOME}/NightlyBuilds
setenv NIGHTLY_SCRIPTS    $REPOSITORY_HOME/trunk/scripts


###############################################################################
#
# parse parameters
#
setenv TARGET_BITS $1

###############################################################################
#
# setup based on machines architecture specified by Shell CSCE
#
setenv CSCE_ARCH `/apps/sss/share/getos2 --os --arch`
echo "  Native platform is $CSCE_ARCH"

# this is used by the new HPC libraries
setenv CSCE_FULL `/apps/sss/share/getos2`
setenv HPC_HOME ${CBM_HOME}/hpc

# 
switch ($CSCE_ARCH)
# Linux 32-bit
case LinuxRHEL_i686:
	echo "  Detected Linux 32-bit environment"
	setenv NATIVE_BITS 32
	if ( $TARGET_BITS == 64 ) then
		echo "    Override target to 64-bit environment"
		echo "!!! Error, this will not work! Exitting"
		exit 1
	endif
	setenv TARGET_BITS 32
        setenv machine Linux32

	# there are no MPI tools defined for this platform

	# Path to correct compiler version
	setenv PATH /usr/bin:${IBS_HOME}/bin:/usr/afsws/bin:${PATH}
	setenv MAKE /apps/oss/bin/make
        breaksw

# Linux 64-bit
case LinuxRHEL64_x86_64:
	echo "  Detected Linux 64-bit environment"
	setenv NATIVE_BITS 64
	if ( $TARGET_BITS == 32 ) then
		echo "    Override target to 32-bit environment"
	        setenv machine Linux32
	else
	        setenv machine Linux64
		setenv TARGET_BITS 64
	endif

	# assume MPICH is used 
	setenv P4_RSHCOMMAND ssh

	# Path to correct compiler version
	setenv PATH /usr/bin:${IBS_HOME}/bin:/usr/afsws/bin:${PATH}
	setenv MAKE /apps/oss/bin/make
        breaksw

# Irix 32-bit
case IRIX_IP32:
	echo "  Detected Irix 32-bit environment"
echo ""
echo ""
echo ""
echo "Error!!!"
echo "   The build environment no longer works on this platform."
echo ""
echo "   Use gocbm.old instead."
echo ""
echo ""
echo ""
exit 1
        breaksw

# Irix 64-bit
case IRIX64_IP27:
case IRIX64_IP30:
	echo "  Detected Irix 64-bit environment"
echo ""
echo ""
echo ""
echo "Error!!!"
echo "   The build environment no longer works on this platform."
echo ""
echo "   Use gocbm.old instead."
echo ""
echo ""
echo ""
exit 1
        breaksw

# Solaris 32-bit
case SunOS_sun4u:
	echo "  Detected Solaris 32-bit environment"
echo ""
echo ""
echo ""
echo "Error!!!"
echo "   The build environment no longer works on this platform."
echo ""
echo "   Use gocbm.old instead."
echo ""
echo ""
echo ""
exit 1
        breaksw

# Solaris 64-bit
case SunOS64_sun4u:
	echo "  Detected Solaris 64-bit environment"
echo ""
echo ""
echo ""
echo "Error!!!"
echo "   The build environment no longer works on this platform."
echo ""
echo "   Use gocbm.old instead."
echo ""
echo ""
echo ""
exit 1
        breaksw

default:
        echo "!!Error: Operating System not recognized."
        echo "  Aborting setup..."
        exit 1
        breaksw
endsw

###############################################################################
#
# setup based on target machine
#
# Define the home directory of the 3rd party libraries
#
# these are under the new format

# MPI definitions
setenv MPI_VERSION	mpich-1.2.6
setenv MPI_HOME         ${HPC_HOME}/mpi/${MPI_VERSION}/${CSCE_FULL}
setenv MPI_D_HOME       ${HPC_HOME}/mpi-debug/${MPI_VERSION}/${CSCE_FULL}
setenv MPI_SHM_HOME     ${HPC_HOME}/mpi-shmem/${MPI_VERSION}/${CSCE_FULL}
setenv MPI_MPD_HOME     ${HPC_HOME}/mpi-p4mpd/${MPI_VERSION}/${CSCE_FULL}
setenv PATH 	${MPI_HOME}/bin:${PATH}

# HDF5 definitions
setenv HDF5_VERSION	1.4.5-post2
setenv HDF5_HOME        ${HPC_HOME}/hdf5/${HDF5_VERSION}/${CSCE_FULL}
setenv HDF5_D_HOME      ${HPC_HOME}/hdf5-debug/${HDF5_VERSION}/${CSCE_FULL}
setenv HDF5_P_HOME      ${HPC_HOME}/hdf5-parallel/${HDF5_VERSION}/${CSCE_FULL}
setenv HDF5_PD_HOME     ${HPC_HOME}/hdf5-parallel-debug/${HDF5_VERSION}/${CSCE_FULL}

#PETSc definitions
setenv PETSC_VERSION	2.1.6
setenv PETSC_ARCH 	linux64
setenv PETSC_HOME       ${HPC_HOME}/petsc/${PETSC_VERSION}/${CSCE_FULL}
setenv PETSC_D_HOME     ${HPC_HOME}/petsc-debug/${PETSC_VERSION}/${CSCE_FULL}



# these are still under the old environment
setenv QT_HOME          ${IBS_3RDPARTY}/QT/curr/${CSCE_ARCH}/${TARGET_BITS}
setenv QWT_HOME         ${IBS_3RDPARTY}/QWT/curr/${CSCE_ARCH}/${TARGET_BITS}
setenv PVTPACK_HOME     ${IBS_3RDPARTY}/PVTPACK/curr/${CSCE_ARCH}/${TARGET_BITS}
setenv EOSPACK_HOME     ${IBS_3RDPARTY}/EOSPACK/curr/${CSCE_ARCH}/${TARGET_BITS}
setenv GENEX5_HOME      ${IBS_3RDPARTY}/GENEX5/curr/${CSCE_ARCH}/${TARGET_BITS}
setenv CBMGENERICS_HOME ${IBS_3RDPARTY}/CBMGENERICS/curr/${CSCE_ARCH}/${TARGET_BITS}
setenv BPA_HOME         ${IBS_3RDPARTY}/BPA/curr/${CSCE_ARCH}/${TARGET_BITS}/OPTIMIZED

# Define make and directories for QT
setenv QTDIR  ${QT_HOME}/OPTIMIZED
setenv QWTDIR ${QWT_HOME}/OPTIMIZED
setenv QMAKE  ${QTDIR}/bin/qmake



# define the default mail program to use
setenv MAIL mailx
# 
switch ($machine)

case Linux32:
	echo "  Setting Linux 32-bit target environment"
	unsetenv USE64BITS
	setenv MAIL mail
        breaksw

case Linux64:
	echo "  Setting Linux 64-bit target environment"
	setenv USE64BITS TRUE

	# define base location of MPICH libraries, only in native mode
	setenv MAIL mail

	# Greg: need library path to run Qt utilities like uic and moc
	setenv LD_LIBRARY_PATH ${QTDIR}/lib/shared
        breaksw

default:
        echo "!!Error: machine name is invalid [$machine]."
        echo "  Aborting setup..."
        exit 1
        breaksw
endsw

#
# define local environment
#
setenv LOCAL `pwd`
#setenv TMPDIR $LOCAL 

# prepend QT library to defined library paths
if ( ${?LD_LIBRARY_PATH} ) then
	setenv LD_LIBRARY_PATH ${QTDIR}/lib:${LD_LIBRARY_PATH}
endif

###############################################################################
#
# setup IBS tools
#
source $IBS_BIN/goibs_develop_startup.login
source $IBS_BIN/goibs_socoms_startup.login

#
# get the tools
source $IBS_BIN/goibs_startup.login
#source $IBS_BIN/goibs_geocase.login

###############################################################################
#
# Add definitions for the Alpha release environment
#
setenv ALPHA_BASE ${CBM_HOME}/alpha
setenv ALPHA_BIN $ALPHA_BASE/bin/$CSCE_ARCH

###############################################################################
#
# Add definitions needed for Subversion version control
#
# prepend subvserion directory before path
#
setenv PATH ${CBM_HOME}/bin/`/apps/sss/share/getos2`:${QTDIR}/bin:${IBS_3RDPARTY}/SUBVERSION/curr/${CSCE_ARCH}/bin:${PATH}
setenv SVN_ARCHIVE svn://rijkes-n-d99610

###############################################################################
#
# Set definitions necessary for licenses
source ${IBS_BIN}/golicense
# 
#  run time development environ for EOSPACK and GENEX5
#
setenv EOSPACKDIR $IBS_NAMES/eospack
setenv GENEX5DIR  $IBS_NAMES/genex50
setenv GENEX6DIR  $IBS_NAMES/genex60
setenv OTGCDIR  $IBS_NAMES/OTGC

# end
