#!/bin/csh
#
# Updates the trunk and branches to the latest release from the repository
#
# Syntax: (called from crontab)
# mm hh * * * /nfs/rvl/groups/ept-sg/SWEast/Cauldron/Repository/trunk/scripts/NightlyUpdate
#
# Notes:
# 1. This script also updates the location where the other scripts will be called
# 2. This script must be csh so we can call gocbm
################################################################################

# setup the development environment
source ~ibs/bin/gocbm >> /dev/null

# define the location of the NightlyUpdate logs
setenv NIGHTLY_LOG $NIGHTLY_HOME/logs/NightlyUpdate.log

echo "--- Starting at `date`" >> ${NIGHTLY_LOG}

set message = ""
set error_found = 0

# update trunk and branches
echo "Updating trunk." >> ${NIGHTLY_LOG}
cd $REPOSITORY_HOME/trunk
if ( $status != 0 ) then
    set message = "Could not move into $NIGHTLY_REPOSITORY/trunk. "
    set error_found = 1
endif

svn update >> ${NIGHTLY_LOG}
if ( $status != 0 ) then
    set message = "$message svn update in trunk failed. " 
    set error_found = 1
endif

echo "Updating branches." >> ${NIGHTLY_LOG}
cd $REPOSITORY_HOME/branches
if ( $status != 0 ) then
    set message = "$message Could not move into $NIGHTLY_REPOSITORY/branches. "
    set error_found = 1
endif

svn update >> ${NIGHTLY_LOG}
if ( $status != 0 ) then
    set message = "$message svn update in branch failed." 
    set error_found = 1
endif

# if an error has been detected, complain and send a mail to the maintainer
if ( error_found == 1 ) then
    echo "$message" >> ${NIGHTLY_LOG}
    echo "$message" | $MAIL -s "NightlyUpdate Error" $CBM_MAINTAINER
else
    echo "Completed successfully." >> ${NIGHTLY_LOG}
endif

# now get out of here
echo "--- Ending at `date`" >> ${NIGHTLY_LOG}
exit 0












