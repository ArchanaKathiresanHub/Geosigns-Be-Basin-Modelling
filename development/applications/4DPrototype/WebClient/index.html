<!DOCTYPE html>
<html>
<head>
    <title>ClientWorkbench</title>
    <script type="text/javascript" src="RemoteVizClient.unmin.js"></script> <!-- include the RemoteViz javascript client -->
	
	<!-- jquery mobile http://jquerymobile.com -->
	<link rel="stylesheet" href="css/jquery.mobile-1.3.2.min.css" /> 

	<script src="js/jquery-1.9.1.min.js"></script>
	<script src="js/jquery.mobile-1.3.2.min.js"></script>
	
    <script type="text/javascript">

        var theRenderArea = null;
		var node = null;
		var color = false;
		var dataSize = 0;
		var fps = 0;		
		
		function receivedImage(length){
			// call when receiving a new image from the service
			dataSize += length;
			fps += 1;
		}
		
		function measurebandwithandfps(){
			// refresh the bandwidth and the fps
			if (node != null){
				node.innerHTML = '<h2>Bandwidth : ' + dataSize / 1000 + ' kb/s</h2><h2>FPS : ' + fps + '</h2>';
				dataSize = 0;
				fps = 0;
			}
		}

        function init() { // This function is called immediately after the page is loaded.
			// Initialization of the renderArea. "TheCanvas" refers to the id of the canvas. "640" and "480" are the requested width and the requested height of the renderArea managed by the service.
            theRenderArea = new RemoteVizRenderArea("TheCanvas", 1024, 768);
			// add a listener on the receivedImage event.
			theRenderArea.addReceivedImageListener(receivedImage);
			// Connects to the service. The IP address and the port refer to those of the service (see main.cpp). "Model" refers to the name of the requested renderArea.
            theRenderArea.connectTo("ws://127.0.0.1:8080/Model");      

			// Bind an event handler to the "slidestop" JavaScript event, or trigger that event on an element.
			$("#slider_maxfps").on('slidestop', maxfps);
			$("#slider_squality").on('slidestop', squality);
			$("#slider_iquality").on('slidestop', iquality);
			$("#slider_scalefactor").on('slidestop', scalefactor);
			$("#slider_snapshot").on('slidestop', snapshot);

			// Calls a function or executes a code snippet repeatedly to refresh the bandwidth and the fps
			window.setInterval("measurebandwithandfps()",1000);
			
			node = document.getElementById('bandwidthfps');
			
        }
		
		function cwidth(){
			// call when changing the canvas width
			if ($("#cwidth").val() != ""){
				document.getElementById("TheCanvas").style.width = $("#cwidth").val();
				theRenderArea.resizeRenderAreaContainer($("#cwidth").val(), $("#cheight").val());
			}
		}
		
		function cheight(){
			// call when changing the canvas height
			if ($("#cheight").val() != ""){
				document.getElementById("TheCanvas").style.height = $("#cheight").val();
				theRenderArea.resizeRenderAreaContainer($("#cwidth").val(), $("#cheight").val());
			}
		}
		
		function rwidth(){
			// call when changing the renderArea width
			if ($("#rwidth").val() != "")
				theRenderArea.sendMessage("WIDTH " + $("#rwidth").val());
		}
		
		function rheight(){
			// call when changing the renderArea height
			if ($("#rheight").val() != "")
				theRenderArea.sendMessage("HEIGHT " + $("#rheight").val());
		}
		
		function maxfps(){
			// call when moving the max fps slider
			theRenderArea.sendMessage("FPS " + $("#slider_maxfps").val());
		}
		
		function squality(){
			// call when moving the still quality slider
			theRenderArea.sendMessage("STILLQUALITY " + $("#slider_squality").val());
		}
		
		function iquality(){
			// call when moving the interactive quality slider
			theRenderArea.sendMessage("INTERACTIVEQUALITY " + $("#slider_iquality").val());
		}
		
		function scalefactor(){
			// call when moving the scale factor slider
			theRenderArea.sendMessage("SCALEFACTOR " + $("#slider_scalefactor").val());
		}
			
		function snapshot(){
			theRenderArea.sendMessage("SNAPSHOT " + $("#slider_snapshot").val());
		}
    </script>
</head>
<body onload="init()" bgcolor="silver">
    <canvas id="TheCanvas"> <!-- canvas displaying the renderArea -->
        Your browser does not support the canvas element.
    </canvas>
	<div style="width: 300px; float: left">
		<div data-role="fieldcontain">
			<h3>Settings</h3>
			<b>SendMaxFPS :</b><br />
			<input type="range" name="slider_maxfps" id="slider_maxfps" value="15" min="1" max="100" data-mini="true" />
			<br />
			<b>Still compression quality :</b><br />
			<input type="range" name="slider_squality" id="slider_squality" value="0.9" step=".1" min="0.1" max="1" data-mini="true" />
			<br />
			<b>Interactive compression quality :</b><br />
			<input type="range" name="slider_iquality" id="slider_iquality" value="0.5" step=".1" min="0.1" max="1" data-mini="true" />
			<br />
			<b>Scale factor :</b><br />
			<input type="range" name="slider_scalefactor" id="slider_scalefactor" value="0.75" step=".1" min="0.1" max="1" data-mini="true" />
			<br />

			<h3>Rendering</h3>
			<b>Snapshot :</b><br />
			<input type="range" name="slider_snapshot" id="slider_snapshot" value="0" min="0" max="100" data-mini="true" />
			<br />

		</div>
	</div>
	<div id="bandwidthfps"></div>
</body>
</html>